@using Web.BlazorServer.ViewModels.Administration.User

@inherits BaseForm<UserPasswordVM>

<PageTitle>Update User Password</PageTitle>

<AppContent>
    <RadzenTemplateForm @ref="@TemplateForm" TItem="UserPasswordVM" @bind-Data="@FormData" EditContext="@EditContext" Submit="@HandleSubmit">
        <RadzenStack>
            <RadzenRow>
                <RadzenColumn Size="12">
                    <RadzenFormField Text="Password" class="rz-w-100">
                        <ChildContent>
                            <RadzenPassword Visible="@(!PasswordVisibility)" @bind-Value="@FormData.Password" Name="user_password_h" Disabled="@IsBusy" class="rz-w-100" />
                            <RadzenTextBox Visible="@PasswordVisibility" @bind-Value="@FormData.Password" Name="user_password_v" Disabled="@IsBusy" class="rz-w-100" />
                        </ChildContent>
                        <End>
                            <RadzenButton Icon="@(PasswordVisibility ? "visibility_off" : "visibility")" Size="ButtonSize.ExtraSmall" Click="@ToggleVisibility" />
                        </End>
                        <Helper>
                            @if (PasswordVisibility)
                            {
                                <RadzenRequiredValidator Popup Component="user_password_v" Text="Password is required" />
                                <RadzenRegexValidator Popup Component="user_password_v" Text="Password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one special character, and must not contain spaces" Pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])\S{8,}$" />
                            }
                            else
                            {
                                <RadzenRequiredValidator Popup Component="user_password_h" Text="Password is required" />
                                <RadzenRegexValidator Popup Component="user_password_h" Text="Password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one special character, and must not contain spaces" Pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])\S{8,}$" />
                            }
                        </Helper>
                    </RadzenFormField>
                </RadzenColumn>
            </RadzenRow>
            <RadzenRow>
                <RadzenColumn Size="12">
                    <RadzenFormField Text="Confirm Password" class="rz-w-100">
                        <ChildContent>
                            <RadzenPassword Visible="@(!ConfirmPasswordVisibility)" @bind-Value="@FormData.ConfirmPassword" Name="user_confirm_password_h" Disabled="@IsBusy" class="rz-w-100" />
                            <RadzenTextBox Visible="@ConfirmPasswordVisibility" @bind-Value="@FormData.ConfirmPassword" Name="user_confirm_password_v" Disabled="@IsBusy" class="rz-w-100" />
                        </ChildContent>
                        <End>
                            <RadzenButton Icon="@(ConfirmPasswordVisibility ? "visibility_off" : "visibility")" Size="ButtonSize.ExtraSmall" Click="@ToggleConfirmVisibility" />
                        </End>
                        <Helper>
                            @if (ConfirmPasswordVisibility)
                            {
                                <RadzenRequiredValidator Popup Component="user_confirm_password_v" Text="Password is required" />
                                <RadzenRegexValidator Popup Component="user_confirm_password_v" Text="Password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one special character, and must not contain spaces" Pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])\S{8,}$" />
                                <RadzenCustomValidator Component="user_confirm_password_v" Popup Text="Passwords do not match" Validator="() => FormData.ConfirmPassword.Equals(FormData.Password)" />
                                
                            }
                            else
                            {
                                <RadzenRequiredValidator Popup Component="user_confirm_password_h" Text="Password is required" />
                                <RadzenRegexValidator Popup Component="user_confirm_password_h" Text="Password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one special character, and must not contain spaces" Pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])\S{8,}$" />
                                <RadzenCustomValidator Component="user_confirm_password_h" Popup Text="Passwords do not match" Validator="() => FormData.ConfirmPassword.Equals(FormData.Password)" />
                            }
                        </Helper>
                    </RadzenFormField>
                </RadzenColumn>
            </RadzenRow>
            <RadzenRow>
                <RadzenColumn>
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center" Gap="8px" class="rz-mt-4">
                        <RadzenButton Text="Cancel" ButtonStyle="ButtonStyle.Base" Disabled="@IsBusy" Click="@CancelEditing" />
                        <RadzenButton Visible="@Can.Update("OUSR")" Text="Update Password" ButtonStyle="ButtonStyle.Success" ButtonType="ButtonType.Submit" Disabled="@IsBusy" />
                    </RadzenStack>
                </RadzenColumn>
            </RadzenRow>

        </RadzenStack>
    </RadzenTemplateForm>
</AppContent>